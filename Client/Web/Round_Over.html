<!DOCTYPE html>
<html>
<head>
    <title>Game Results</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <h2>Here are the results of the last round:</h2>
    
    <div id="tableContainer"></div>
    <button onclick="window.location.href='Play_Game.html?table=' + tableId + '&player=' + playerName" style="margin: 10px;">Return to game</button>
  <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const tableId = urlParams.get('table') || 'default'; // Use 'default' as fallback
        const playerName = urlParams.get('player') || 'unknown'; // Use 'unknown' as fallback
        function fetchGameState() {
            fetch(`http://192.168.68.100:8080/results?table=${tableId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayTable(data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    const container = document.getElementById('tableContainer');
                    container.innerHTML = `<p style="color: red;">Error loading data: ${error.message}</p>`;
                });
        }

        function displayTable(data) {
            const container = document.getElementById('tableContainer');
            if (!data || typeof data !== 'object') {
                container.innerHTML = '<p style="color: red;">Invalid data received</p>';
                return;
            }
            
            let allTablesHtml = '';


// List of  Players and their scores
if (data.pls) {
    allTablesHtml += '<table style="width: auto;">';
    const players = Array.isArray(data.pls) ? data.pls : [data.pls];
    const message = Array.isArray(data.msg) ? data.msg : [data.msg];
    allTablesHtml += `<tr><th>${message.join('<br>')}</th></tr>`;
    players.forEach(player => {
        let handHtml = '<td>';
        allTablesHtml += `<tr><th>${player.n}'s cards are</th></tr>`;

        if (Array.isArray(player.ph)) {
            player.ph.forEach(card => {
                const cardValue = typeof card === 'object' ? card.Cardvalue : card;
                handHtml += `<img src="LlamaCard${cardValue}.png" alt="Card ${cardValue}" style="width:100px; margin:2px;">`;
            });
        } else if (player.ph) {
            handHtml += player.ph;
        } else {
            handHtml += 'No cards';
        }
        handHtml += '</td>';
        allTablesHtml += `<tr>${handHtml}</tr>`;


        allTablesHtml += `<tr><th>${player.m1}</BR>${player.m2}</th></tr>`;
        
        allTablesHtml += `<tr></tr>`;
    });
    
    allTablesHtml += '</table>';
}
container.innerHTML = allTablesHtml || '<p>No data available</p>';
        }

        // Fetch data when page loads
        fetchGameState();

 


    </script>
</body>
</html>        

